(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();/**
 * @preserve
 * Kontra.js v9.0.0
 */let $=()=>{},Xt="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function yt(i,t){let e=t.parentNode;if(i.setAttribute("data-kontra",""),e){let s=e.querySelector("[data-kontra]:last-of-type")||t;e.insertBefore(i,s.nextSibling)}else document.body.appendChild(i)}function H(i,t){let e=i.indexOf(t);if(e!=-1)return i.splice(e,1),!0}let D={};function A(i,t){D[i]=D[i]||[],D[i].push(t)}function zt(i,t){D[i]=(D[i]||[]).filter(e=>e!=t)}function L(i,...t){(D[i]||[]).map(e=>e(...t))}let Y,et,It={get(i,t){return t=="_proxy"?!0:$}};function b(){return Y}function E(){return et}function ke(i,{contextless:t=!1}={}){if(Y=document.getElementById(i)||i||document.querySelector("canvas"),t&&(Y=Y||new Proxy({},It)),!Y)throw Error("You must provide a canvas element for the game");return et=Y.getContext("2d")||new Proxy({},It),et.imageSmoothingEnabled=!1,L("init"),{canvas:Y,context:et}}class dt{constructor({spriteSheet:t,frames:e,frameRate:s,loop:n=!0,name:r}){let{width:h,height:o,margin:l=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:s,loop:n,name:r,width:h,height:o,margin:l,isStopped:!1,_f:0,_a:0})}clone(){return new dt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:s=this.width,height:n=this.height,context:r=E()}){let h=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,o*this.width+(o*2+1)*this.margin,h*this.height+(h*2+1)*this.margin,this.width,this.height,t,e,s,n)}}function Wt(){return new dt(...arguments)}let Ge=/(jpeg|jpg|gif|png|webp)$/,Ie=/(wav|mp3|ogg|aac)$/,Ft=/^\//,Ye=/\/$/,qt=new WeakMap,Kt="",Qt="",Jt="";function ct(i,t){return new URL(i,t).href}function St(i,t){return[i.replace(Ye,""),i?t.replace(Ft,""):t].filter(e=>e).join("/")}function Et(i){return i.split(".").pop()}function Ct(i){let t=i.replace("."+Et(i),"");return t.split("/").length==2?t.replace(Ft,""):t}function Ne(i){return{wav:i.canPlayType('audio/wav; codecs="1"'),mp3:i.canPlayType("audio/mpeg;"),ogg:i.canPlayType('audio/ogg; codecs="vorbis"'),aac:i.canPlayType("audio/aac;")}}let N={},B={},T={};function bt(){window.__k||(window.__k={dm:qt,u:ct,d:T,i:N})}function Te(i){Kt=i}function Re(i){Qt=i}function $e(i){Jt=i}function Vt(i){return bt(),new Promise((t,e)=>{let s,n,r;if(s=St(Kt,i),N[s])return t(N[s]);n=new Image,n.onload=function(){r=ct(s,window.location.href),N[Ct(i)]=N[s]=N[r]=this,L("assetLoaded",this,i),t(this)},n.onerror=function(){e("Unable to load image "+s)},n.src=s})}function Zt(i){return new Promise((t,e)=>{let s=i,n,r,h,o;if(n=new Audio,r=Ne(n),i=[].concat(i).reduce((l,a)=>l||(r[Et(a)]?a:null),0),!i)return e("cannot play any of the audio formats provided "+s);if(h=St(Qt,i),B[h])return t(B[h]);n.addEventListener("canplay",function(){o=ct(h,window.location.href),B[Ct(i)]=B[h]=B[o]=this,L("assetLoaded",this,i),t(this)}),n.onerror=function(){e("Unable to load audio "+h)},n.src=h,n.load()})}function jt(i){bt();let t,e;return t=St(Jt,i),T[t]?Promise.resolve(T[t]):fetch(t).then(s=>{if(!s.ok)throw s;return s.clone().json().catch(()=>s.text())}).then(s=>(e=ct(t,window.location.href),typeof s=="object"&&qt.set(s,e),T[Ct(i)]=T[t]=T[e]=s,L("assetLoaded",s,i),s))}function Ue(...i){return bt(),Promise.all(i.map(t=>{let e=Et([].concat(t)[0]);return e.match(Ge)?Vt(t):e.match(Ie)?Zt(t):jt(t)}))}function Be(i){return i*Math.PI/180}function De(i){return i*180/Math.PI}function He(i,t){return Math.atan2(t.y-i.y,t.x-i.x)}function te(i,t){let e=Math.sin(t),s=Math.cos(t);return{x:i.x*s-i.y*e,y:i.x*e+i.y*s}}function Xe(i,t,e){return{x:i.x+Math.cos(t)*e,y:i.y+Math.sin(t)*e}}function ze(i,t){return(Math.random()*(t-i+1)|0)+i}function We(i){for(var t=0,e=2166136261>>>0;t<i.length;t++)e=Math.imul(e^i.charCodeAt(t),16777619);e+=e<<13,e^=e>>>7,e+=e<<3,e^=e>>>17;let s=(e+=e<<5)>>>0,n=()=>(2**31-1&(s=Math.imul(48271,s)))/2**31;return n(),n}function Fe(i,t,e){return i*(1-e)+t*e}function qe(i,t,e){return(e-i)/(t-i)}function X(i,t,e){return Math.min(Math.max(i,e),t)}function Ke(i,t){t==null?localStorage.removeItem(i):localStorage.setItem(i,JSON.stringify(t))}function Qe(i){let t=localStorage.getItem(i);try{t=JSON.parse(t)}catch{}return t}function ee(i,t){return[i,t]=[i,t].map(e=>Q(e)),i.x<t.x+t.width&&i.x+i.width>t.x&&i.y<t.y+t.height&&i.y+i.height>t.y}function Q(i){let{x:t=0,y:e=0,width:s,height:n}=i.world||i;return i.mapwidth&&(s=i.mapwidth,n=i.mapheight),i.anchor&&(t-=s*i.anchor.x,e-=n*i.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(e+=n,n*=-1),{x:t,y:e,width:s,height:n}}function Je(i,t,e="y"){return[i,t]=[i,t].map(Q),i[e]-t[e]}class R{constructor(t=0,e=0,s={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new R(this.x+t.x,this.y+t.y,this)}subtract(t){return new R(this.x-t.x,this.y-t.y,this)}scale(t){return new R(this.x*t,this.y*t)}normalize(t=this.length()||1){return new R(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,s,n){this._c=!0,this._a=t,this._b=e,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?X(this._a,this._d,t):t}set y(t){this._y=this._c?X(this._b,this._e,t):t}}function it(){return new R(...arguments)}class Ve{constructor(t){return this.init(t)}init(t={}){this.position=it(),this.velocity=it(),this.acceleration=it(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class z extends Ve{init({width:t=0,height:e=0,context:s=E(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:o={x:0,y:0},opacity:l=1,rotation:a=0,scaleX:d=1,scaleY:c=1,...u}={}){this._c=[],super.init({width:t,height:e,context:s,anchor:o,opacity:l,rotation:a,scaleX:d,scaleY:c,...u}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r,A("init",()=>{this.context??(this.context=E())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(e||s)&&t.translate(e,s),this.context.globalAlpha=this.opacity,this._rf(),(e||s)&&t.translate(-e,-s),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:s=1,_wr:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:o,y:l}=te({x:this._wx,y:this._wy},n);this._wx=o,this._wy=l,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||$,e._pc()})}removeChild(...t){t.flat().map(e=>{H(this.children,e)&&(e.parent=null,e._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=X(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function Ze(){return new z(...arguments)}class At extends z{init({image:t,width:e=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:e,height:s,...n})}get animations(){return this._a}set animations(t){let e,s;this._a={};for(e in t)this._a[e]=t[e].clone(),s=s||this._a[e];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function je(){return new At(...arguments)}let ti=/(\d+)(\w+)/;function ei(i){if(!i)return{computed:0};let t=i.match(ti),e=+t[1],s=t[2];return{size:e,unit:s,computed:e}}class ie extends z{init({text:t="",textAlign:e="",lineHeight:s=1,font:n=(h=>(h=E())==null?void 0:h.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:s,font:n,...r}),this.context&&this._p(),A("init",()=>{this.font??(this.font=E().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ei(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(s=>{let n=s.split(" "),r=n.shift(),h=r;n.map(o=>{h+=" "+o,t.measureText(h).width>this._fw&&(this._s.push(r),h=o),r=h}),this._s.push(h)}),!this._s.length&&this.text.includes(`
`)){let s=0;e.map(n=>{this._s.push(n),s=Math.max(s,t.measureText(n).width)}),this._w=this._fw||s}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,s=this.context;e=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=e,s.fillStyle=this.color,s.font=this.font,this.strokeColor&&(s.strokeStyle=this.strokeColor,s.lineWidth=this.lineWidth??1,s.strokeText(n,t,this._fs*this.lineHeight*r)),s.fillText(n,t,this._fs*this.lineHeight*r)})}}function se(){return new ie(...arguments)}let k=new WeakMap,st={},ut={},ne={0:"left",1:"middle",2:"right"};function ii(i=b()){return k.get(i)}function si(i,t){let{x:e,y:s,width:n,height:r}=Q(i);do e-=i.sx||0,s-=i.sy||0;while(i=i.parent);let h=t.x-Math.max(e,Math.min(t.x,e+n)),o=t.y-Math.max(s,Math.min(t.y,s+r));return h*h+o*o<t.radius*t.radius}function re(i){let t=i._lf.length?i._lf:i._cf;for(let e=t.length-1;e>=0;e--){let s=t[e];if(s.collidesWithPointer?s.collidesWithPointer(i):si(s,i))return s}}function S(i,t){return parseFloat(i.getPropertyValue(t))||0}function ni(i){let{canvas:t,_s:e}=i,s=t.getBoundingClientRect(),n=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),o=(S(e,"border-left-width")+S(e,"border-right-width"))*r,l=(S(e,"border-top-width")+S(e,"border-bottom-width"))*h,a=(S(e,"padding-left")+S(e,"padding-right"))*r,d=(S(e,"padding-top")+S(e,"padding-bottom"))*h;return{scaleX:(s.width-o-a)/t.width,scaleY:(s.height-l-d)/t.height,offsetX:s.left+(S(e,"border-left-width")+S(e,"padding-left"))*r,offsetY:s.top+(S(e,"border-top-width")+S(e,"padding-top"))*h}}function Yt(i){let t=i.button!=null?ne[i.button]:"left";ut[t]=!0,Mt(i,"onDown")}function xt(i){let t=i.button!=null?ne[i.button]:"left";ut[t]=!1,Mt(i,"onUp")}function Nt(i){Mt(i,"onOver")}function ri(i){let t=k.get(i.target);t._oo=null,ut={}}function Tt(i,t,e){let s=re(i);s&&s[t]&&s[t](e),st[t]&&st[t](e,s),t=="onOver"&&(s!=i._oo&&i._oo&&i._oo.onOut&&i._oo.onOut(e),i._oo=s)}function Mt(i,t){i.preventDefault();let e=i.target,s=k.get(e),{scaleX:n,scaleY:r,offsetX:h,offsetY:o}=ni(s);i.type.includes("touch")?(Array.from(i.touches).map(({clientX:a,clientY:d,identifier:c})=>{let u=s.touches[c];u||(u=s.touches[c]={start:{x:(a-h)/n,y:(d-o)/r}},s.touches.length++),u.changed=!1}),Array.from(i.changedTouches).map(({clientX:a,clientY:d,identifier:c})=>{let u=s.touches[c];u.changed=!0,u.x=s.x=(a-h)/n,u.y=s.y=(d-o)/r,Tt(s,t,i),L("touchChanged",i,s.touches),t=="onUp"&&(delete s.touches[c],s.touches.length--,s.touches.length||L("touchEnd"))})):(s.x=(i.clientX-h)/n,s.y=(i.clientY-o)/r,Tt(s,t,i))}function he({radius:i=5,canvas:t=b()}={}){let e=k.get(t);if(!e){let s=window.getComputedStyle(t);e={x:0,y:0,radius:i,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},k.set(t,e)}return t.addEventListener("mousedown",Yt),t.addEventListener("touchstart",Yt),t.addEventListener("mouseup",xt),t.addEventListener("touchend",xt),t.addEventListener("touchcancel",xt),t.addEventListener("blur",ri),t.addEventListener("mousemove",Nt),t.addEventListener("touchmove",Nt),e._t||(e._t=!0,A("tick",()=>{e._lf.length=0,e._cf.map(s=>{e._lf.push(s)}),e._cf.length=0})),e}function oe(...i){i.flat().map(t=>{let e=t.context?t.context.canvas:b(),s=k.get(e);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))})}function hi(...i){i.flat().map(t=>{let e=t.context?t.context.canvas:b(),s=k.get(e);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t._r,t._r=0,H(s._o,t)})}function oi(i){let t=i.context?i.context.canvas:b(),e=k.get(t);if(!e)throw new ReferenceError("Pointer events not initialized for the objects canvas");return e._o.includes(i)&&re(e)===i}function ae(i,t){let e=i[0].toUpperCase()+i.substr(1);st["on"+e]=t}function le(i){let t=i[0].toUpperCase()+i.substr(1);st["on"+t]=0}function ai(i){return!!ut[i]}let de=class extends At{init({padX:t=0,padY:e=0,text:s,disabled:n=!1,onDown:r,onUp:h,...o}={}){super.init({padX:t,padY:e,...o}),this.textNode=se({...s,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),oe(this),this.addChild(this.textNode),this._od=r||$,this._ou=h||$;let l=this._dn=document.createElement("button");l.style=Xt,l.textContent=this.text,n&&this.disable(),l.addEventListener("focus",()=>this.focus()),l.addEventListener("blur",()=>this.blur()),l.addEventListener("keydown",a=>this._kd(a)),l.addEventListener("keyup",a=>this._ku(a)),yt(l,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,e=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}};function li(){return new de(...arguments)}function di(i){let t=i.canvas;i.clearRect(0,0,t.width,t.height)}function ce({fps:i=60,clearCanvas:t=!0,update:e=$,render:s,context:n=E(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,o=1e3/i,l=1/i,a=t?di:$,d,c,u,p,g,w=!0;r||(window.addEventListener("focus",()=>{w=!0}),window.addEventListener("blur",()=>{w=!1})),A("init",()=>{g.context??(g.context=E())});function _(){if(c=requestAnimationFrame(_),!!w&&(u=performance.now(),p=u-d,d=u,!(p>1e3))){for(L("tick"),h+=p;h>=o;)g.update(l),h-=o;a(g.context),g.render()}}return g={update:e,render:s,isStopped:!0,context:n,start(){d=performance.now(),this.isStopped=!1,requestAnimationFrame(_)},stop(){this.isStopped=!0,cancelAnimationFrame(c)},_frame:_,set _last(f){d=f}},g}let M=[],nt={},rt={},ft={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function ci(i){M[i.gamepad.index]={pressedButtons:{},axes:{}}}function ui(i){delete M[i.gamepad.index]}function fi(){M.map(i=>{i.pressedButtons={},i.axes={}})}function ue(){let i=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<i.length;t++){let e=i[t];if(!e)continue;e.buttons.map((n,r)=>{let h=ft[r],{pressed:o}=n,{pressedButtons:l}=M[e.index],a=l[h];!a&&o?[nt[e.index],nt].map(d=>{var c;(c=d==null?void 0:d[h])==null||c.call(d,e,n,h)}):a&&!o&&[rt[e.index],rt].map(d=>{var c;(c=d==null?void 0:d[h])==null||c.call(d,e,n,h)}),l[h]=o});let{axes:s}=M[e.index];s.leftstickx=e.axes[0],s.leftsticky=e.axes[1],s.rightstickx=e.axes[2],s.rightsticky=e.axes[3]}}function fe(){window.addEventListener("gamepadconnected",ci),window.addEventListener("gamepaddisconnected",ui),window.addEventListener("blur",fi),A("tick",ue)}function pe(i,t,{gamepad:e,handler:s="gamepaddown"}={}){let n=s=="gamepaddown"?nt:rt;[].concat(i).map(r=>{isNaN(e)?n[r]=t:(n[e]=n[e]||{},n[e][r]=t)})}function _e(i,{gamepad:t,handler:e="gamepaddown"}={}){let s=e=="gamepaddown"?nt:rt;[].concat(i).map(n=>{isNaN(t)?delete s[n]:(s[t]=s[t]||{},delete s[t][n])})}function pi(i,{gamepad:t}={}){return isNaN(t)?M.some(e=>e.pressedButtons[i]):M[t]?!!M[t].pressedButtons[i]:!1}function _i(i,t){var e;return((e=M[t])==null?void 0:e.axes[i])||0}let ht={},Z,Rt=!1,ot={swipe:{touches:1,threshold:10,touchend({0:i}){let t=i.x-i.start.x,e=i.y-i.start.y,s=Math.abs(t),n=Math.abs(e);if(!(s<this.threshold&&n<this.threshold))return s>n?t<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:i,1:t}){this.prevDist=Math.hypot(i.x-t.x,i.y-t.y)},touchmove({0:i,1:t}){let e=Math.hypot(i.x-t.x,i.y-t.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let s=e>this.prevDist?"out":"in";return this.prevDist=e,s}}};function ge(){Rt||(Rt=!0,A("touchChanged",(i,t)=>{Object.keys(ot).map(e=>{var r;let s=ot[e],n;(!Z||Z==e)&&t.length==s.touches&&[...Array(t.length).keys()].every(h=>t[h])&&(n=((r=s[i.type])==null?void 0:r.call(s,t))??"")&&ht[e+n]&&(Z=e,ht[e+n](i,t))})}),A("touchEnd",()=>{Z=0}))}function we(i,t){[].concat(i).map(e=>{ht[e]=t})}function me(i){[].concat(i).map(t=>{ht[t]=0})}let gi={set(i,t,e){return t.startsWith("_")||(i._d=!0),Reflect.set(i,t,e)}},$t={start(i){return i?1:0},center(){return .5},end(i){return i?0:1}};class xe extends z{init({flow:t="column",align:e="start",justify:s="start",colGap:n=0,rowGap:r=0,numCols:h=1,dir:o="",breakpoints:l=[],...a}={}){return super.init({flow:t,align:e,justify:s,colGap:n,rowGap:r,numCols:h,dir:o,breakpoints:l,...a}),this._p(),new Proxy(this,gi)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(f=>{f.metric.call(this)&&this._b!==f&&(this._b=f,f.callback.call(this))});let t=this._g=[],e=this._cw=[],s=this._rh=[],n=this.children,r=this._nc=this.flow=="column"?1:this.flow=="row"?n.length:this.numCols,h=0,o=0;for(let f=0,m;m=n[f];f++){t[h]=t[h]||[],m._p&&m._p();let{width:U,height:x}=m.world||m;s[h]=Math.max(s[h]||0,x);let v=m.colSpan||1,C=v;do e[o]=Math.max(e[o]||0,U/C),t[h][o]=m;while(o++<=r&&--v);o>=r&&(o=0,h++)}for(;o>0&&o<r;)t[h][o++]=!1;let l=t.length,a=[].concat(this.colGap),d=[].concat(this.rowGap);this._w=e.reduce((f,m)=>f+=m,0);for(let f=0;f<r-1;f++)this._w+=a[f%a.length];this._h=s.reduce((f,m)=>f+=m,0);for(let f=0;f<l-1;f++)this._h+=d[f%d.length];this._uw();let u=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=u,u&&(this._g=t.map(f=>f.reverse()),this._cw=e.reverse(),a=a.reverse());let p=-this.anchor.y*this.height,g=[],w=[].concat(this.justify),_=[].concat(this.align);this._g.map((f,m)=>{let U=-this.anchor.x*this.width;f.map((x,v)=>{if(x&&!g.includes(x)){g.push(x);let C=$t[x.justifySelf||w[v%w.length]](this._rtl),V=$t[x.alignSelf||_[m%_.length]](),gt=x.colSpan||1,Gt=e[v];if(gt>1&&v+gt<=this._nc)for(let P=1;P<gt;P++)Gt+=e[v+P]+a[(v+P)%a.length];let G=Gt*C,I=s[m]*V,W=0,F=0,{width:wt,height:mt}=x.world||x;if(x.anchor&&(W=x.anchor.x,F=x.anchor.y),C==0)G=G+wt*W;else if(C==.5){let P=W<.5?-1:W==.5?0:1;G=G+P*wt*C}else G=G-wt*(1-W);if(V==0)I=I+mt*F;else if(V==.5){let P=F<.5?-1:F==.5?0:1;I=I+P*mt*V}else I=I-mt*(1-F);x.x=U+G,x.y=p+I}U+=e[v]+a[v%a.length]}),p+=s[m]+d[m%d.length]})}}function wi(){return new xe(...arguments)}let Pt={},Ot={},pt={},O={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function ye(i=$,t){i._pd&&t.preventDefault(),i(t)}function mi(i){let t=O[i.code],e=Pt[t];pt[t]=!0,ye(e,i)}function xi(i){let t=O[i.code],e=Ot[t];pt[t]=!1,ye(e,i)}function yi(){pt={}}function ve(){let i;for(i=0;i<26;i++)O["Key"+String.fromCharCode(i+65)]=String.fromCharCode(i+97);for(i=0;i<10;i++)O["Digit"+i]=O["Numpad"+i]=""+i;window.addEventListener("keydown",mi),window.addEventListener("keyup",xi),window.addEventListener("blur",yi)}function Se(i,t,{handler:e="keydown",preventDefault:s=!0}={}){let n=e=="keydown"?Pt:Ot;t._pd=s,[].concat(i).map(r=>n[r]=t)}function Ee(i,{handler:t="keydown"}={}){let e=t=="keydown"?Pt:Ot;[].concat(i).map(s=>delete e[s])}function vi(i){return!![].concat(i).some(t=>pt[t])}function at(i,t){return Object.values(t).includes(i)}function Ce(i){return Object.keys(ot).some(t=>i.startsWith(t))}function Si(i={}){ve();let t=he(i.pointer);return ge(),fe(),{pointer:t}}function Ei(i,t,{gamepad:e,key:s}={}){[].concat(i).map(n=>{if(at(n,ft))pe(n,t,e);else if(Ce(n))we(n,t);else if(at(n,O))Se(n,t,s);else if(["down","up"].includes(n))ae(n,t);else throw new TypeError(`"${n}" is not a valid input name`)})}function Ci(i,{gamepad:t,key:e}={}){[].concat(i).map(s=>{at(s,ft)?_e(s,t):Ce(s)?me(s):at(s,O)?Ee(s,e):["down","up"].includes(s)&&le(s)})}function be(i){let t=i.substr(i.search(/[A-Z]/));return t[0].toLowerCase()+t.substr(1)}function bi(i,t){let e=i.prototype;e&&(e._inc||(e._inc={},e._bInc=function(n,r,...h){return this._inc[r].before.reduce((o,l)=>{let a=l(n,...o);return a||o},h)},e._aInc=function(n,r,h,...o){return this._inc[r].after.reduce((l,a)=>{let d=a(n,l,...o);return d||l},h)}),Object.getOwnPropertyNames(t).map(s=>{let n=be(s);e[n]&&(e["_o"+n]||(e["_o"+n]=e[n],e[n]=function(...h){let o=this._bInc(this,n,...h),l=e["_o"+n].call(this,...o);return this._aInc(this,n,l,...h)}),e._inc[n]||(e._inc[n]={before:[],after:[]}),s.startsWith("before")?e._inc[n].before.push(t[s]):s.startsWith("after")&&e._inc[n].after.push(t[s]))}))}function Ai(i,t){let e=i.prototype;!e||!e._inc||Object.getOwnPropertyNames(t).map(s=>{let n=be(s);s.startsWith("before")?H(e._inc[n].before,t[s]):s.startsWith("after")&&H(e._inc[n].after,t[s])})}function Mi(i,t){let e=i.prototype;e&&Object.getOwnPropertyNames(t).map(s=>{e[s]||(e[s]=t[s])})}class Ae{constructor({create:t,maxSize:e=1024}={}){let s;if(!t||!(s=t())||!(s.update&&s.init&&s.isAlive&&s.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let s=0;s<this.size&&this.objects.length<this.maxSize;s++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,s=!1;for(let n=this.size;n--;)e=this.objects[n],e.update(t),e.isAlive()||(s=!0,this.size--);s&&this.objects.sort((n,r)=>r.isAlive()-n.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function Pi(){return new Ae(...arguments)}function Ut(i,t){let e=[],s=t.x+t.width/2,n=t.y+t.height/2,r=i.y<n,h=i.y+i.height>=n;return i.x<s&&(r&&e.push(0),h&&e.push(2)),i.x+i.width>=s&&(r&&e.push(1),h&&e.push(3)),e}class _t{constructor({maxDepth:t=3,maxObjects:e=25,bounds:s}={}){this.maxDepth=t,this.maxObjects=e;let n=b();this.bounds=s||{x:0,y:0,width:n.width,height:n.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(t){let e=new Set;for(;this._s.length&&this._b;)return Ut(t,this.bounds).map(s=>{this._s[s].get(t).map(n=>e.add(n))}),Array.from(e);return this._o.filter(s=>s!==t)}add(...t){t.flat().map(e=>{if(this._b){this._a(e);return}this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(s=>this._a(s)),this._o.length=0)})}_a(t){Ut(t,this.bounds).map(e=>{this._s[e].add(t)})}_sp(t,e,s){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,s=0;s<4;s++)this._s[s]=new _t({bounds:{x:this.bounds.x+(s%2==1?t:0),y:this.bounds.y+(s>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[s]._d=this._d+1}}function Oi(){return new _t(...arguments)}function vt(i){let t=[];return i._dn?t.push(i._dn):i.children&&i.children.map(e=>{t=t.concat(vt(e))}),t}class Me{constructor({id:t,name:e=t,objects:s=[],context:n=E(),cullObjects:r=!0,cullFunction:h=ee,sortFunction:o,...l}){this._o=[],Object.assign(this,{id:t,name:e,context:n,cullObjects:r,cullFunction:h,sortFunction:o,...l});let a=this._dn=document.createElement("section");a.tabIndex=-1,a.style=Xt,a.id=t,a.setAttribute("aria-label",e);let d=this;class c extends z{set x(p){d.sx=p-this.centerX,super.x=p}get x(){return super.x}set y(p){d.sy=p-this.centerY,super.y=p}get y(){return super.y}}this.camera=new c({context:n,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(s),this._i=()=>{this.context??(this.context=E());let u=this.context.canvas,{width:p,height:g}=u,w=p/2,_=g/2;Object.assign(this.camera,{centerX:w,centerY:_,x:w,y:_,width:p,height:g}),this._dn.isConnected||yt(this._dn,u)},this.context&&this._i(),A("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,vt(e).map(s=>{this._dn.appendChild(s)})})}remove(...t){t.flat().map(e=>{H(this._o,e),e.parent=null,vt(e).map(s=>{yt(s,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){zt("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:s}=t.world||t;this.camera.x=e,this.camera.y=s}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:s,_sy:n,camera:r,sortFunction:h,cullObjects:o,cullFunction:l}=this;e.translate(s,n);let a=t;o&&(a=a.filter(d=>l(r,d))),h&&a.sort(h),a.map(d=>d.render&&d.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:s,y:n,centerX:r,centerY:h}=e;t.save(),this._sx=r-s,this._sy=h-n,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function Li(){return new Me(...arguments)}function ki(i){if(+i==i)return i;let t=[],e=i.split(".."),s=+e[0],n=+e[1],r=s;if(s<n)for(;r<=n;r++)t.push(r);else for(;r>=n;r--)t.push(r);return t}class Pe{constructor({image:t,frameWidth:e,frameHeight:s,frameMargin:n,animations:r}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:s,margin:n},this._f=t.width/e|0,this.createAnimations(r)}createAnimations(t){let e,s;for(s in t){let{frames:n,frameRate:r,loop:h}=t[s];if(e=[],n==null)throw Error("Animation "+s+" must provide a frames property");[].concat(n).map(o=>{e=e.concat(ki(o))}),this.animations[s]=Wt({spriteSheet:this,frames:e,frameRate:r,loop:h,name:s})}}}function Gi(){return new Pe(...arguments)}function j(i,t){return i/t|0}function tt(i,t){return i/t|0}class Oe{constructor(t={}){let{width:e,height:s,tilewidth:n,tileheight:r,tilesets:h}=t,o=e*n,l=s*r,a=document.createElement("canvas");a.width=o,a.height=l,this._c=a,this._ctx=a.getContext("2d"),h.map(d=>{let{__k:c,location:u}=window,p=(c?c.dm.get(t):"")||u.href,{source:g}=d;if(g){if(!c)throw Error('You must use "load" or "loadData" to resolve tileset.source');let _=c.d[c.u(g,p)];if(!_)throw Error(`You must load the tileset source "${g}" before loading the tileset`);Object.keys(_).map(f=>{d[f]=_[f]})}let{image:w}=d;if(""+w===w){if(!c)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let _=c.i[c.u(w,p)];if(!_)throw Error(`You must load the image "${w}" before loading the tileset`);d.image=_}}),Object.assign(this,{context:E(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),A("init",()=>{this.context??(this.context=E()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-b().width);this._sx=X(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-b().height);this._sy=X(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{H(this._o,e),e.parent=null})}setTileAtLayer(t,e,s){let{layerMap:n,tileheight:r,tilewidth:h,width:o}=this,{row:l,col:a,x:d,y:c}=e,u=l??j(c,r),p=a??tt(d,h);n[t]&&(this._d=!0,n[t]._d=!0,n[t].data[u*o+p]=s)}setLayer(t,e){let{layerMap:s}=this;s[t]&&(this._d=!0,s[t]._d=!0,s[t].data=e)}layerCollidesWith(t,e){let{tilewidth:s,tileheight:n,layerMap:r}=this,{x:h,y:o,width:l,height:a}=Q(e),d=j(o,n),c=tt(h,s),u=j(o+a,n),p=tt(h+l,s),g=r[t];for(let w=d;w<=u;w++)for(let _=c;_<=p;_++)if(g.data[_+w*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:s,tileheight:n,tilewidth:r,width:h}=this,{row:o,col:l,x:a,y:d}=e,c=o??j(d,n),u=l??tt(a,r);return s[t]?s[t].data[c*h+u]:-1}render(t=this._c,e=!0){let{_d:s,context:n,sx:r=0,sy:h=0}=this;s&&this._p();let{width:o,height:l}=b(),a=Math.min(t.width,o),d=Math.min(t.height,l);n.drawImage(t,r,h,a,d,0,0,a,d),e&&(n.save(),(r||h)&&n.translate(-r,-h),this.objects.map(c=>c.render&&c.render()),n.restore())}renderLayer(t){let{layerCanvases:e,layerMap:s}=this,n=s[t],r=e[t],h=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:o,mapheight:l}=this;r=document.createElement("canvas"),h=r.getContext("2d"),r.width=o,r.height=l,e[t]=r,this._r(n,h)}n._d&&(n._d=!1,h.clearRect(0,0,r.width,r.height),this._r(n,h)),this.render(r,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:s}=this;this._d=!1,e.map(n=>{let{name:r,data:h,visible:o}=n;n._d=!1,s[r]=n,h&&o!=!1&&this._r(n,t)})}_r(t,e){let{opacity:s,data:n=[]}=t,{tilesets:r,width:h,tilewidth:o,tileheight:l}=this;e.save(),e.globalAlpha=s,n.map((a,d)=>{if(!a)return;let c;for(let C=r.length-1;C>=0&&(c=r[C],!(a/c.firstgid>=1));C--);let{image:u,margin:p=0,firstgid:g,columns:w}=c,_=a-g,f=w??u.width/(o+p)|0,m=d%h*o,U=(d/h|0)*l,x=_%f*(o+p),v=(_/f|0)*(l+p);e.drawImage(u,x,v,o,l,m,U,o,l)}),e.restore()}}function Ii(){return new Oe(...arguments)}let y={Animation:Wt,AnimationClass:dt,imageAssets:N,audioAssets:B,dataAssets:T,setImagePath:Te,setAudioPath:Re,setDataPath:$e,loadImage:Vt,loadAudio:Zt,loadData:jt,load:Ue,Button:li,ButtonClass:de,init:ke,getCanvas:b,getContext:E,on:A,off:zt,emit:L,GameLoop:ce,GameObject:Ze,GameObjectClass:z,gamepadMap:ft,updateGamepad:ue,initGamepad:fe,onGamepad:pe,offGamepad:_e,gamepadPressed:pi,gamepadAxis:_i,gestureMap:ot,initGesture:ge,onGesture:we,offGesture:me,Grid:wi,GridClass:xe,degToRad:Be,radToDeg:De,angleToTarget:He,rotatePoint:te,movePoint:Xe,randInt:ze,seedRand:We,lerp:Fe,inverseLerp:qe,clamp:X,setStoreItem:Ke,getStoreItem:Qe,collides:ee,getWorldRect:Q,depthSort:Je,initInput:Si,onInput:Ei,offInput:Ci,keyMap:O,initKeys:ve,onKey:Se,offKey:Ee,keyPressed:vi,registerPlugin:bi,unregisterPlugin:Ai,extendObject:Mi,initPointer:he,getPointer:ii,track:oe,untrack:hi,pointerOver:oi,onPointer:ae,offPointer:le,pointerPressed:ai,Pool:Pi,PoolClass:Ae,Quadtree:Oi,QuadtreeClass:_t,Scene:Li,SceneClass:Me,Sprite:je,SpriteClass:At,SpriteSheet:Gi,SpriteSheetClass:Pe,Text:se,TextClass:ie,TileEngine:Ii,TileEngineClass:Oe,Vector:it,VectorClass:R};const Yi=document.getElementById("#game-canvas");y.init(Yi);y.initKeys();y.initPointer();var J=(i=>(i.MENU="menu",i.GAME="game",i))(J||{}),Lt=(i=>(i.CHANGE_SCENE="changeScene",i))(Lt||{});const{Button:Ni}=y,Bt=y.getCanvas();let q=Ni({text:{color:"white",font:"30px Monospace",text:"Start",anchor:{x:.5,y:.5}},anchor:{x:.5,y:.5},x:Bt.width/2,y:Bt.height/2,onUp(){console.log("Change to game"),y.emit(Lt.CHANGE_SCENE,J.GAME)},render(){this.draw(),this.focused||this.hovered?this.textNode.color="red":this.textNode.color="white"}});y.track(q);const kt=y.Scene({id:J.MENU,onShow(){q.text="Start",q.focus()},focus(){q.focus()}});kt.add(q);const{Button:Ti}=y,Dt=y.getCanvas();let K=Ti({text:{color:"white",font:"30px Monospace",text:"Start",anchor:{x:.5,y:.5}},anchor:{x:.5,y:.5},x:Dt.width/2,y:Dt.height/2,onUp(){console.log("change to menu"),y.emit(Lt.CHANGE_SCENE,J.MENU)},render(){this.draw(),this.focused||this.hovered?this.textNode.color="red":this.textNode.color="white"}});y.track(K);const Le=y.Scene({id:J.GAME,onShow(){K.text="Win",K.focus()},focus(){K.focus()}});Le.add(K);const Ri=[kt,Le],Ht=Ri.reduce((i,t)=>({...i,[t.id]:t}),{});let lt=kt;y.on("changeScene",i=>{if(Ht[i]!==void 0){const t=Ht[i];lt.hide(),t.show(),lt=t}});const $i=ce({update:()=>lt.update(),render:()=>lt.render()});$i.start();
